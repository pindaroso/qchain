#!/bin/bash

export COMPOSE_PROJECT_NAME=qchain

OPTIONS="dev [migrate] | clean | deploy <host>"

cd src

case "$1" in
    "dev")
        shift;
        docker-compose -f docker-compose.dev.yml stop
        docker-compose -f docker-compose.dev.yml rm -f

        docker-compose -f docker-compose.dev.yml build
        docker-compose -f docker-compose.dev.yml up -d

        case "$1" in
            "migrate")
                docker exec -it web npm run migrate
                ;;
            *)
                echo "Usage: ./deployment/bin/compose dev [migrate]"
                ;;
        esac
        ;;
    "bounce")
        docker-compose build
        docker-compose up -d
        ;;
    "deploy")
        echo "Not yet implemented..."
        ;;
    "*")
        echo "Usage: ./deployment/bin/compose [$OPTIONS]"
        ;;
esac
